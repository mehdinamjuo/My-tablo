<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Magic Frame AR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ØªØ§Ø¨Ù„Ùˆ Ù…ØªØ­Ø±Ú© AR - Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆÛŒØ¯ÛŒÙˆ Ùˆ ØµØ¯Ø§">
<meta name="theme-color" content="#000000">

<!-- A-Frame Ùˆ MindAR -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

<!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #000;
  font-family: 'Vazirmatn', sans-serif;
}

/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ØµØ­Ù†Ù‡ */
a-scene {
  position: fixed !important;
  top: 0;
  left: 0;
  width: 100% !important;
  height: 100% !important;
  z-index: 1;
}

/* Loader Ø¨Ø§ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ */
#loader {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.5s;
}

.loader-content {
  text-align: center;
  padding: 20px;
  max-width: 90%;
}

#loader h1 {
  font-size: 1.8rem;
  margin-bottom: 10px;
  background: linear-gradient(90deg, #00dbde, #fc00ff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

#loader p {
  margin: 15px 0;
  color: #aaa;
  font-size: 0.95rem;
}

#progressBar {
  width: 80%;
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  margin: 20px auto;
  overflow: hidden;
}

#progressFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #00dbde, #fc00ff);
  border-radius: 10px;
  transition: width 0.3s;
}

#progressText {
  font-size: 0.9rem;
  color: #00dbde;
  margin-top: 5px;
}

/* Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ */
#hint {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 12px 20px;
  border-radius: 25px;
  z-index: 9998;
  opacity: 0;
  transition: opacity 0.5s;
  border: 1px solid rgba(0, 219, 222, 0.3);
  backdrop-filter: blur(5px);
  text-align: center;
  max-width: 90%;
  font-size: 0.9rem;
}

/* Ù†Ø´Ø§Ù†Ú¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ */
.detection-indicator {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80px;
  height: 80px;
  z-index: 9997;
  opacity: 0;
  transition: opacity 0.3s;
}

.detection-indicator.visible {
  opacity: 1;
}

.detection-circle {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 3px solid rgba(0, 219, 222, 0.3);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(0.8);
    opacity: 0.7;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.3;
  }
  100% {
    transform: scale(0.8);
    opacity: 0.7;
  }
}

.detection-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  color: #00dbde;
}

/* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… */
#systemInfo {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.6);
  color: #00dbde;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 0.8rem;
  z-index: 9996;
  border: 1px solid rgba(0, 219, 222, 0.2);
  backdrop-filter: blur(5px);
  opacity: 0.7;
  transition: opacity 0.3s;
}

#systemInfo:hover {
  opacity: 1;
}

/* Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù */
.hidden {
  display: none !important;
}

.visible {
  opacity: 1 !important;
}

/* ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ */
@media (max-width: 768px) {
  #loader h1 {
    font-size: 1.5rem;
  }
  
  #hint {
    bottom: 20px;
    font-size: 0.85rem;
    padding: 10px 16px;
  }
  
  .detection-indicator {
    width: 60px;
    height: 60px;
  }
  
  .detection-icon {
    font-size: 24px;
  }
  
  #systemInfo {
    top: 10px;
    left: 10px;
    font-size: 0.75rem;
    padding: 8px 12px;
  }
}

@media (max-width: 480px) {
  #loader h1 {
    font-size: 1.3rem;
  }
  
  #hint {
    bottom: 15px;
    font-size: 0.8rem;
    padding: 8px 14px;
  }
}
</style>
</head>

<body>

<!-- Loader -->
<div id="loader">
  <div class="loader-content">
    <h1>ØªØ§Ø¨Ù„Ùˆ Ù…ØªØ­Ø±Ú© AR</h1>
    <p>Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡...</p>
    <div id="progressBar">
      <div id="progressFill"></div>
    </div>
    <div id="progressText">0%</div>
    <p id="loaderStatus">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§</p>
  </div>
</div>

<!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ -->
<div class="detection-indicator" id="detectionIndicator">
  <div class="detection-circle"></div>
  <div class="detection-icon">ğŸ“±</div>
</div>

<!-- Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§ -->
<div id="hint">ØªØ§Ø¨Ù„Ùˆ Ø±Ø§ Ù…Ù‚Ø§Ø¨Ù„ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ú¯ÛŒØ±ÛŒØ¯</div>

<!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… -->
<div id="systemInfo">
  <div>Ø³Ø±Ø¹Øª Ù„ÙˆØ¯: <span id="loadSpeed">--</span>ms</div>
  <div>ÙˆØ¶Ø¹ÛŒØª: <span id="arStatus">Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</span></div>
</div>

<!-- ØµØ­Ù†Ù‡ A-Frame -->
<a-scene
  mindar-image="
    imageTargetSrc: targets.mind;
    uiScanning: false;
    uiLoading: false;
    uiError: false;
    filterMinCF: 0.001;
    filterBeta: 0.001;
  "
  embedded
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:false"
  renderer="antialias: true; precision: high;"
>

<a-assets>
  <!-- ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ ØµØ¯Ø§ ÙØ¹Ø§Ù„ -->
  <video id="vid" src="video.mp4" loop playsinline webkit-playsinline preload="auto"></video>
</a-assets>

<a-entity mindar-image-target="targetIndex:0">
  <a-video src="#vid" width="1" height="0.6" position="0 0 0"></a-video>
</a-entity>

<a-camera look-controls="enabled:false"></a-camera>
</a-scene>

<script>
// Ø¹Ù†Ø§ØµØ± DOM
const scene = document.querySelector("a-scene");
const vid = document.getElementById("vid");
const loader = document.getElementById("loader");
const loaderStatus = document.getElementById("loaderStatus");
const progressFill = document.getElementById("progressFill");
const progressText = document.getElementById("progressText");
const hint = document.getElementById("hint");
const detectionIndicator = document.getElementById("detectionIndicator");
const systemInfo = document.getElementById("systemInfo");
const loadSpeedElement = document.getElementById("loadSpeed");
const arStatusElement = document.getElementById("arStatus");

// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø¹Øª Ù„ÙˆØ¯
const startTime = performance.now();
const totalResources = 3; // A-Frame, MindAR, ÙˆÛŒØ¯ÛŒÙˆ
let loadSpeed = 0;

// Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ
function updateLoaderProgress(step, message) {
  const progress = Math.min(step * 33, 100);
  progressFill.style.width = `${progress}%`;
  progressText.textContent = `${Math.round(progress)}%`;
  loaderStatus.textContent = message;
  
  if (step >= totalResources) {
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø±Ø¹Øª Ù„ÙˆØ¯
    loadSpeed = Math.round(performance.now() - startTime);
    loadSpeedElement.textContent = loadSpeed;
    
    // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
    setTimeout(() => {
      arStatusElement.textContent = "Ø¢Ù…Ø§Ø¯Ù‡";
    }, 500);
  }
}

// Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…Ù†Ø§Ø¨Ø¹
document.addEventListener("DOMContentLoaded", () => {
  // Ù…Ø±Ø­Ù„Ù‡ 1: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ A-Frame
  setTimeout(() => updateLoaderProgress(1, "Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…ÙˆØªÙˆØ± AR"), 300);
  
  // Ù…Ø±Ø­Ù„Ù‡ 2: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ MindAR
  setTimeout(() => updateLoaderProgress(2, "Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ ØªØµÙˆÛŒØ±"), 800);
  
  // Ù…Ø±Ø­Ù„Ù‡ 3: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ
  vid.onloadeddata = () => {
    updateLoaderProgress(3, "Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ Ùˆ ØµØ¯Ø§");
    console.log("ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ ØµØ¯Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯");
  };
  
  // Ø§Ú¯Ø± ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² Ù‚Ø¨Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡
  if (vid.readyState >= 3) {
    updateLoaderProgress(3, "Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ Ùˆ ØµØ¯Ø§");
  }
  
  // Ø®Ø·Ø§ÛŒ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ
  vid.addEventListener("error", () => {
    console.warn("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ");
  });
});

// Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ AR
scene.addEventListener("arReady", () => {
  // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† loader
  setTimeout(() => {
    loader.style.opacity = "0";
    setTimeout(() => {
      loader.style.display = "none";
      
      // Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§
      setTimeout(() => {
        hint.style.opacity = "1";
      }, 300);
    }, 500);
  }, 500);
  
  // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
  systemInfo.style.opacity = "0.7";
  
  arStatusElement.textContent = "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³Ú©Ù†";
});

scene.addEventListener("targetFound", () => {
  // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ù†Ø´Ø§Ù†Ú¯Ø±
  hint.style.opacity = "0";
  detectionIndicator.classList.remove("visible");
  
  // Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ ØµØ¯Ø§
  vid.play().then(() => {
    console.log("ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ ØµØ¯Ø§ Ù¾Ø®Ø´ Ø´Ø¯");
    arStatusElement.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´";
  }).catch(e => {
    console.warn("Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ:", e);
    
    // Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª
    if (e.name === "NotAllowedError") {
      hint.textContent = "Ø¨Ø±Ø§ÛŒ Ù¾Ø®Ø´ØŒ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø¶Ø±Ø¨Ù‡ Ø¨Ø²Ù†ÛŒØ¯";
      hint.style.opacity = "1";
      
      // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø®Ø´ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ú©Ø§Ø±Ø¨Ø±
      const playOnClick = () => {
        vid.play().then(() => {
          hint.style.opacity = "0";
          document.removeEventListener("click", playOnClick);
          document.removeEventListener("touchstart", playOnClick);
        });
      };
      
      document.addEventListener("click", playOnClick);
      document.addEventListener("touchstart", playOnClick);
    }
  });
});

scene.addEventListener("targetLost", () => {
  // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ù†Ø´Ø§Ù†Ú¯Ø±
  hint.style.opacity = "1";
  detectionIndicator.classList.add("visible");
  
  // ØªÙˆÙ‚Ù ÙˆÛŒØ¯ÛŒÙˆ
  vid.pause();
  vid.currentTime = 0;
  
  arStatusElement.textContent = "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³Ú©Ù†";
});

// Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ AR
scene.addEventListener("arError", (e) => {
  console.error("Ø®Ø·Ø§ÛŒ AR:", e.detail);
  arStatusElement.textContent = "Ø®Ø·Ø§";
  
  // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
  hint.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ… AR. ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.";
  hint.style.opacity = "1";
});

// Ù†Ù…Ø§ÛŒØ´ Ù†Ø´Ø§Ù†Ú¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
setTimeout(() => {
  if (!vid.paused) return; // Ø§Ú¯Ø± ÙˆÛŒØ¯ÛŒÙˆ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ Ø§Ø³Øª Ù†Ø´Ø§Ù† Ù†Ø¯Ù‡
  detectionIndicator.classList.add("visible");
}, 1000);

// Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
setInterval(() => {
  if (!vid.paused) {
    arStatusElement.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ (${Math.round(vid.currentTime)}/${Math.round(vid.duration)}s)`;
  }
}, 1000);
</script>

</body>
</html>
