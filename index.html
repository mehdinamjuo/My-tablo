<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Magic Frame AR - Fullscreen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

<style>
  /* تنظیمات حیاتی برای نمایش تمام صفحه */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  html, body { 
    width: 100%; 
    height: 100%; 
    overflow: hidden; 
    background: #000;
    position: fixed; /* جلوگیری از اسکرول ناخواسته در iOS */
  }

  /* فیکس کردن دوربین روی تمام صفحه */
  .mindar-ui-overlay { z-index: 10; }
  
  video {
    width: 100vw !important;
    height: 100vh !important;
    object-fit: cover !important; /* این خط دوربین را فیکس تمام صفحه می‌کند */
    position: absolute;
    top: 0;
    left: 0;
  }

  /* لودینگ سریع */
  #loader {
    position: fixed; inset: 0;
    background: #000;
    color: white; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 10000; transition: opacity 0.3s;
  }

  #progressBar {
    width: 70%; height: 3px; background: rgba(255,255,255,0.1);
    border-radius: 10px; margin-top: 15px; overflow: hidden;
  }
  #progressFill { height: 100%; width: 0%; background: #00dbde; transition: width 0.1s; }

  #hint {
    position: fixed; bottom: 15%; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.6); color: #fff; padding: 10px 20px;
    border-radius: 20px; z-index: 999; opacity: 0; pointer-events: none;
    font-family: sans-serif; font-size: 14px;
  }
</style>
</head>

<body>

<div id="loader">
  <div id="progressBar"><div id="progressFill"></div></div>
  <p style="margin-top: 10px; font-size: 12px;">Loading AR...</p>
</div>

<div id="hint">تابلو را اسکن کنید</div>

<a-scene
  mindar-image="imageTargetSrc: targets.mind; uiScanning: false; uiLoading: false; warmUpTolerance: 5; missTolerance: 30;"
  embedded color-space="sRGB"
  renderer="antialias: false; precision: medium; alpha: true; logarithmicDepthBuffer: true;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-assets>
    <video id="vid" src="video.mp4" 
           loop="true" crossorigin="anonymous" 
           playsinline webkit-playsinline 
           preload="auto"></video>
  </a-assets>

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0">
    <a-video src="#vid" width="1" height="0.6" position="0 0 0"></a-video>
  </a-entity>
</a-scene>

<script>
const scene = document.querySelector("a-scene");
const vid = document.getElementById("vid");
const loader = document.getElementById("loader");
const fill = document.getElementById("progressFill");

// شبیه‌ساز لودینگ سریع
let p = 0;
const interval = setInterval(() => {
    if(p < 95) { p += 5; fill.style.width = p + "%"; }
}, 50);

scene.addEventListener("arReady", () => {
    clearInterval(interval);
    fill.style.width = "100%";
    setTimeout(() => {
        loader.style.opacity = "0";
        setTimeout(() => loader.style.display = "none", 300);
        document.getElementById("hint").style.opacity = "1";
    }, 200);
});

scene.addEventListener("targetFound", () => {
    document.getElementById("hint").style.opacity = "0";
    vid.play().catch(() => {
        // برای گوشی‌هایی که اجازه اتوپلی نمی‌دهند
        window.addEventListener('click', () => vid.play(), {once: true});
        window.addEventListener('touchstart', () => vid.play(), {once: true});
    });
});

scene.addEventListener("targetLost", () => {
    vid.pause();
    document.getElementById("hint").style.opacity = "1";
});
</script>

</body>
</html>
